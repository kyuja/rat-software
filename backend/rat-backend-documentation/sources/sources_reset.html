<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.1">
<title>backend.sources.sources_reset API documentation</title>
<meta name="description" content="Class to handle the resetting of failed scraping jobs …">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>backend.sources.sources_reset</code></h1>
</header>
<section id="section-intro">
<p>Class to handle the resetting of failed scraping jobs.</p>
<p>This class provides functionality to reset scraping jobs that have failed or been pending for too long. It updates the status of these jobs and logs the operations for tracking purposes.</p>
<h2 id="dependencies">Dependencies</h2>
<ul>
<li>datetime: For timestamp operations.</li>
<li>json: For handling JSON data (if required in other parts of the code).</li>
<li>os: For path operations.</li>
<li>inspect: For inspecting the current file path.</li>
<li>Custom libraries: lib_db, lib_logger, lib_helper</li>
</ul>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="backend.sources.sources_reset.SourcesReset"><code class="flex name class">
<span>class <span class="ident">SourcesReset</span></span>
<span>(</span><span>db: object, logger: object)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles the resetting of failed scraping jobs.</p>
<h2 id="attributes">Attributes</h2>
<dl>
<dt><strong><code>db</code></strong> :&ensp;<code>object</code></dt>
<dd>Database object used for querying and updating job statuses.</dd>
<dt><strong><code>logger</code></strong> :&ensp;<code>object</code></dt>
<dd>Logger object used for logging reset operations.</dd>
</dl>
<h2 id="methods">Methods</h2>
<p><strong>init</strong>(db: object, logger: object): Initializes the SourcesReset object.
<strong>del</strong>(): Destructor for the SourcesReset object.
reset(db: object): Resets jobs that have been pending for too long.</p>
<p>Initializes the SourcesReset object.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>db</code></strong> :&ensp;<code>object</code></dt>
<dd>Database object for querying and updating job statuses.</dd>
<dt><strong><code>logger</code></strong> :&ensp;<code>object</code></dt>
<dd>Logger object for logging operations.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class SourcesReset:
    &#34;&#34;&#34;
    Handles the resetting of failed scraping jobs.

    Attributes:
        db (object): Database object used for querying and updating job statuses.
        logger (object): Logger object used for logging reset operations.

    Methods:
        __init__(db: object, logger: object): Initializes the SourcesReset object.
        __del__(): Destructor for the SourcesReset object.
        reset(db: object): Resets jobs that have been pending for too long.
    &#34;&#34;&#34;

    def __init__(self, db: object, logger: object):
        &#34;&#34;&#34;
        Initializes the SourcesReset object.

        Args:
            db (object): Database object for querying and updating job statuses.
            logger (object): Logger object for logging operations.
        &#34;&#34;&#34;
        self.db = db
        self.logger = logger

    def __del__(self):
        &#34;&#34;&#34;
        Destructor for the SourcesReset object.

        Prints a message when the SourcesReset object is destroyed.
        &#34;&#34;&#34;
        print(&#39;Sources Reset object destroyed&#39;)

    def reset(self, db: object, job_server):
        &#34;&#34;&#34;
        Resets the jobs that have been pending for too long.

        This method retrieves all pending sources from the database, checks if they have been pending for more than a specified threshold (0.2 hours), and if so, resets their status.

        Args:
            db (object): Database object used to interact with the sources and update their status.
        &#34;&#34;&#34;
        sources_pending = db.get_sources_pending(job_server)  # Retrieve all pending sources       

        for s in sources_pending:
            result_source_id = s[0]
            source_id = s[1]
            result_id = s[2]
            
            if source_id:
   
                print(f&#34;Resetting source ID: {source_id}&#34;)
                log = f&#34;Reset \t source \t {source_id} \t&#34;
                self.logger.write_to_log(log)
                
                # Update the source&#39;s status in the database
                counter = db.get_source_counter_result(result_id) + 1
                progress = 0
                created_at = datetime.now()
                
                db.reset_result_source(progress, counter, created_at, source_id)
                db.delete_source_pending(source_id, progress, created_at)

            else:
                print(f&#34;Resetting source ID: {source_id}&#34;)
                log = f&#34;Reset \t source \t {source_id} \t&#34;
                self.logger.write_to_log(log)
                db.delete_result_source_pending(result_source_id)

        db.update_sources_failed(job_server) # Reset all finally failed sources (counter &gt; 10)</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="backend.sources.sources_reset.SourcesReset.reset"><code class="name flex">
<span>def <span class="ident">reset</span></span>(<span>self, db: object, job_server)</span>
</code></dt>
<dd>
<div class="desc"><p>Resets the jobs that have been pending for too long.</p>
<p>This method retrieves all pending sources from the database, checks if they have been pending for more than a specified threshold (0.2 hours), and if so, resets their status.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>db</code></strong> :&ensp;<code>object</code></dt>
<dd>Database object used to interact with the sources and update their status.</dd>
</dl></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="backend.sources" href="index.html">backend.sources</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="backend.sources.sources_reset.SourcesReset" href="#backend.sources.sources_reset.SourcesReset">SourcesReset</a></code></h4>
<ul class="">
<li><code><a title="backend.sources.sources_reset.SourcesReset.reset" href="#backend.sources.sources_reset.SourcesReset.reset">reset</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.1</a>.</p>
</footer>
</body>
</html>
